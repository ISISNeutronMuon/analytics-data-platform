tls:
  certificates:
    - certFile: /certs/analytics.dev.pem
      keyFile: /certs/analytics.dev-key.pem

http:
  routers:
    traefik:
      entryPoints: websecure
      rule: Host(`analytics.dev`) && (PathPrefix(`/traefik`) || HeaderRegexp(`Referer`, `/traefik`))
      service: api@internal
      middlewares:
        - traefik-strip-prefix
      tls: {}

    keycloak:
      entryPoints: websecure
      rule: Host(`analytics.dev`) && PathPrefix(`/keycloak`)
      middlewares:
        - keycloak-strip-prefix
      service: keycloak
      tls: {}

    minio-console:
      entryPoints: websecure
      rule: Host(`analytics.dev`) && PathPrefix(`/minio/console`)
      middlewares:
        - minio-console-strip-prefix
      service: minio-console
      tls: {}

    minio-api:
      entryPoints: websecure
      rule: Host(`analytics.dev`) && PathPrefix(`/minio/api`)
      middlewares:
        - minio-api-strip-prefix
      service: minio-api
      tls: {}

    lakekeeper:
      entryPoints: websecure
      rule: Host(`analytics.dev`) && PathPrefix(`/lakekeeper`)
      middlewares:
        - lakekeeper-strip-prefix
      service: lakekeeper
      tls: {}

    trino:
      entryPoints: trinosecure
      rule: Host(`analytics.dev`) && PathPrefix(`/`)
      service: trino
      tls: {}

  middlewares:
    traefik-strip-prefix:
      stripPrefix:
        prefixes:
          - "/traefik"
    keycloak-strip-prefix:
      stripPrefix:
        prefixes:
          - "/keycloak"
    minio-console-strip-prefix:
      stripPrefix:
        prefixes:
          - "/minio/console"
    minio-api-strip-prefix:
      stripPrefix:
        prefixes:
          - "/minio/api"
    lakekeeper-strip-prefix:
      stripPrefix:
        prefixes:
          - "/lakekeeper"

  services:
    keycloak:
      loadBalancer:
        servers:
          - url: "http://keycloak:8080"
    minio-console:
      loadBalancer:
        servers:
          - url: "http://minio:9001"
    minio-api:
      loadBalancer:
        servers:
          - url: "http://minio:9000"
    lakekeeper:
      loadBalancer:
        servers:
          - url: "http://lakekeeper:8181"
    trino:
      loadBalancer:
        servers:
          - url: "http://trino:8080"
