# Dynamic traefik configuration

http:
  routers:
    traefik:
      entryPoints: websecure
      rule: PathPrefix(`/traefik`) || HeaderRegexp(`Referer`, `/traefik`)
      service: api@internal
      middlewares:
        - traefik-strip-prefix
        - dashboardauth
      tls: {}
    jupyterhub:
      entryPoints: websecure
      rule: PathPrefix(`/jupyterhub`)
      service: jupyterhub
      tls: {}
    trino:
      entryPoints: trinosecure
      rule: PathPrefix(`/`)
      service: trino
      tls: {}

  middlewares:
    dashboardauth:
      basicauth:
        users: admin:$2y$10$xRntwpemRqOvRaDz6kLt1ed3d5JcHZSjTdlO3tCiKmnN42hdrQsA6
    traefik-strip-prefix:
      stripPrefixRegex:
        regex:
          - "/traefik"

  services:
    jupyterhub:
      loadBalancer:
        servers:
          - url: "http://{{ groups['jupyterhub'][0] }}:{{ jupyterhub_http_port }}"
    trino:
      loadBalancer:
        servers:
          - url: "{{ trino_coordinator_url }}"

tls:
  certificates:
    - certFile: /certs/dataplatform_cert.pem
      keyFile: /certs/dataplatform_key.pem
